---
date: 2023-07-30T18:09:28+08:00
title: "从零开始的计算机网络4-9"
draft: false
description: "四.网络层"
url: "/learn/1-4-9"
keywords:
- 计算机网络
categories:
- 学
tags:
- 计算机网络
---

# 虚拟专用网VPN与网络地址转换NAT

### 虚拟专用网VPN(Virtual Private Network)

**利用公用的因特网**作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网。由于IPv4地址的紧缺，一个机构能够申请到的IPv4地址数量往往远小于本机构所拥有的主机数量。因此，**虚拟专用网中的各主机所分配的地址应该是本机构可自由分配的专用地址**，而不是需要申请的、在因特网上使用的公有地址。

专用(私有)地址:
10.0.0.0~10.255.255.255(10/8地址块)
172.16.0.0~172.31.255.255(172.16/12地址块)

192.168.0.0~192.168.255.255(192.168/16地址块)

> 私有地址只能用于机构内部通信，而不能用于和因特网上的主机通信。

![](https://img.0pt.im/computernet/4-9/4-9-1.png)

从逻辑上看，R1和R2好像是一条直通的点对点链路。因此也被称为IP隧道技术

同一机构内不同部门的内部网络所构成的虚拟专用网VPN又称为**内联网VPN**
有时一个机构的VPN需要有某些外部机构（通常就是合作伙伴）参加进来。这样的VPN就称为**外联网VPN**，在外地工作的员工需要访问公司内部的专用网络时，只要在任何地点接入到因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，即可访问专用网络中的资源。这种VPN称为**远程接入VPN**。



网络地址转换NAT(Network Address Translation)

虽然因特网采用了无分类编址方式来减缓IPv4地址空间耗尽的速度，但由于因特网用户数目的激增，特别是大量小型办公室网络和家庭网络接入因特网的需求不断增加，IPv4地址空间即将面临耗尽的危险仍然没有被解除。

1994年提出了一种网络地址转换NAT的方法再次**缓解了IPv4地址空间即将耗尽的问题**。

NAT能使大量**使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源**。

![](https://img.0pt.im/computernet/4-9/4-9-2.png)

![](https://img.0pt.im/computernet/4-9/4-9-3.png)

该转换方法存在一个问题:如果NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网上的主机通信。

由于绝大多数的网络应用都是使用运输层协议TCP或UDP来传送数据，因此可以利用运输层的端口号和IP地址一起进行转换。这样，**用一个全球IP地址就可以使多个拥有本地地址的主机同时和因特网上的主机进行通信**。这种将端口号和IP地址一起进行转换的技术叫作**网络地址与端口号转换NAPT**(Network Address and Port Translation)。

![](https://img.0pt.im/computernet/4-9/4-9-4.png)

外网主机不能首先对内网中的主机发起通信，因为NAPT转换表里找不到相应记录。

内网主机不能直接充当因特网服务器。

对于一些P2P网络应用，需要外网主机主动与内网主机进行通信，在通过NAT时会遇到问题,需要网络应用自己使用一些特殊的NAT穿越技术来解决问题。

另外，由于NAT对外网屏蔽了内网主机的网络地址，能为内网的主机提供一定的安全保护。
