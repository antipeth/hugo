---
date: 2023-07-21T18:09:28+08:00
title: "从零开始的计算机网络3-11"
draft: false
description: "三.数据链路层"
url: "/learn/1-3-11"
keywords:
- 计算机网络
categories:
- 学
tags:
- 计算机网络
---

# 虚拟局域网VLAN

### 概述

以太网交换机工作在数据链路层（也包括物理层）

使用一个或多个以太网交换机互连起来的交换式以太网，其所有站点都属于**同一个广播域**。

随着交换式以太网规模的扩大，广播域相应扩大。

巨大的广播域会带来很多**弊端**:

- 广播风暴

- 难以管理和维护

- 潜在的安全问题

广播风暴会浪费网络资源和各主机的CPU资源!

![](https://img.0pt.im/computernet/3-11/3-11-1.png)

分割广播域的方法

![](https://img.0pt.im/computernet/3-11/3-11-2.png)

- 使用路由器可以隔离广播域，路由器的成本较高。

- 虚拟局域网VLAN技术应运而生

虚拟局域网VLAN(Virtual Local Area Network)是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求。

![](https://img.0pt.im/computernet/3-11/3-11-3.png)

### 实现机制

IEEE 802.1Q帧

IEEE 802.1Q帧（也称Dot One Q帧）对以太网的MAC帧格式进行了扩展，插入了**4字节的VLAN标记**

![](https://img.0pt.im/computernet/3-11/3-11-4.png)

VLAN标记的**最后12比特**称为**VLAN标识符VID**，它唯一地标志了以太网帧属于哪一个VLAN.

- VID的取值范围是0~4095 (0 ~2^(12-1))

- 0和4095都不用来表示VLAN，因此用于表示VLAN的**VID的有效取值范围是1~4094**。

0和4095都不用来表示VLAN，因此用于表示VLAN的VID的有效取值范围是1~4094。

**802.1Q帧是由交换机来处理的，而不是用户主机来处理的。**

- 当交换机**收到普通的以太网帧**时，会将其插入4字节的VLAN标记转变为802.1Q帧，简称“**打标签**“

- 当交换机**转发802.1Q帧**时，**可能**会删除其4字节VLAN标记转变为普通以太网帧，简称“**去标签**”

交换机的端口类型

交换机的端口类型有以下三种:

- Access

- Trunk

- Hybrid

> 思科交换机没有Hybrid端口

交换机各端口的缺省VLAN ID

- 在思科交换机上称为Native VLAN，即本征VLAN。

- 在华为交换机上称为Port VLAN ID，即端口VLAN ID，简记为PVID。

Access端口一般用于连接用户计算机

Access端口只能属于一个VLAN

Access端口的PVID值与端口所属VLAN的ID相同(默认为1)

Access端口接收处理方法:

一般只接受“未打标签”的普通以太网MAC帧。根据接收帧的端口的PVID给帧“**打标签**”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。

Access端口发送处理方法:

若帧中的VID与端口的PVID相等，则“**去标签**”并**转发**该帧;否则不转发。

| ![](https://img.0pt.im/computernet/3-11/3-11-5.png) | ![](https://img.0pt.im/computernet/3-11/3-11-6.png) |
| --------------------------------------------------- | --------------------------------------------------- |

Trunk端口一般用于交换机之间或交换机与路由器之间的互连

Trunk端口可以属于多个VLAN

用户可以设置Trunk端口的PVID值。默认情况下，Trunk端口的PVID值为1。

Trunk端口发送处理方法:

- 对VID等于PVID的帧，**“去标签”再转发**;

- 对VID不等于PVID的帧，**直接转发**;

Trunk端口接收处理方法:

- 接收“未打标签”的帧，根据接收帧的端口的PVID给帧“**打标签**”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。

- 接收“已打标签的帧”;

| ![](https://img.0pt.im/computernet/3-11/3-11-7.png) | ![](https://img.0pt.im/computernet/3-11/3-11-8.png) |
| --------------------------------------------------- | --------------------------------------------------- |

例题：

![](https://img.0pt.im/computernet/3-11/3-11-9.png)

上图给出了用于交换机互连的Trunk端口的PVID值的组合，试回答以下问题:

(1)主机A发送广播帧，则帧的传递过程是什么?

(2)主机C发送广播帧，则帧的传递过程是什么?

(3)从上述过程可以得出什么结论?

解析：

![](https://img.0pt.im/computernet/3-11/3-11-10.png)

结论：互连的Trunk端口的PVID值不等,可能会造成转发错误!

Hybrid端口既可用于交换机之间或交换机与路由器之间的互连(同Trunk端口)，也可用于交换机与用户计算机之间的互连(同Access端口)

Hybrid端口可以属于多个VLAN(同Trun端口)用户可以设置Hybrid端口的PVID值。默认情况下,Hybrid端口的PVID值为1(同Trun端口)

Hybrid端口发送处理方法(与Trunk端口不同)查看帧的VID是否在端口的“去标签”列表中:

- 若存在，则“去标签”后再转发;

- 若不存在，则直接转发;

Hybrid端口接收处理方法(同Trunk端口)

- 接收“未打标签”的帧，根据接收帧的端口的PVID给帧“打标签”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。

- 接收“已打标签的帧”;

【应用举例】主机A、B、C连接在同一个交换机的不同接口上。利用Hybrid端口的功能，实现以下应用需求:A和B都能与C相互通信，但A与B不能相互通信。

| ![](https://img.0pt.im/computernet/3-11/3-11-11.png) | ![](https://img.0pt.im/computernet/3-11/3-11-12.png) |
| ---------------------------------------------------- | ---------------------------------------------------- |
